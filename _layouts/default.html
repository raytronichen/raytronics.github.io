<!DOCTYPE html>
<html lang="{{ page.lang | default: site.default_lang }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
  <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
  
  <!-- SEO Meta Tags -->
  <meta name="author" content="{{ site.author }}">
  <meta name="keywords" content="{% if page.tags %}{{ page.tags | join: ', ' }}, {% endif %}{{ site.keywords | default: 'eink, epaper, epaper frame, eink frame, epaper frames, eink frames, eink canvas, epaper canvas, epaper photo frame, eink photo frame, inkjoy, inkjoy frame' }}">
  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
  <meta property="og:url" content="{{ page.url | replace:'index.html','' | absolute_url }}">
  <meta property="og:title" content="{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}">
  <meta property="og:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
  <meta property="og:site_name" content="{{ site.title }}">
  {% if page.image %}
  <meta property="og:image" content="{{ page.image | absolute_url }}">
  {% elsif page.url == '/' %}
  <meta property="og:image" content="{{ site.url }}/pics/main.jpeg">
  {% endif %}
  <meta property="og:locale" content="en_US">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="{{ page.url | replace:'index.html','' | absolute_url }}">
  <meta name="twitter:title" content="{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}">
  <meta name="twitter:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
  {% if page.image %}
  <meta name="twitter:image" content="{{ page.image | absolute_url }}">
  {% elsif page.url == '/' %}
  <meta name="twitter:image" content="{{ site.url }}/pics/main.jpeg">
  {% endif %}
  
  <!-- RSS Feed -->
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ '/feed.xml' | relative_url }}">
  
  <!-- Structured Data for Homepage -->
  {% if page.layout == 'default' and page.url == '/' %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": {{ site.title | jsonify }},
    "url": "{{ site.url }}",
    "description": {{ site.description | jsonify }},
    "keywords": {{ site.keywords | default: 'eink, epaper, epaper frame, eink frame, epaper frames, eink frames, eink canvas, epaper canvas, epaper photo frame, eink photo frame, inkjoy, inkjoy frame' | jsonify }},
    "author": {
      "@type": "Person",
      "name": "Ray Chen",
      "jobTitle": "Founder of InkJoy Frame",
      "url": "{{ site.url }}/about"
    },
    "publisher": {
      "@type": "Organization",
      "name": "InkJoy",
      "url": "{{ site.url }}"
    },
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ site.url }}/search?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  {% endif %}
  
  <!-- Google Analytics -->
  {% if site.google_analytics %}
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ site.google_analytics }}');
  </script>
  {% endif %}
  
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
</head>
<body>
  <header class="site-header">
    <div class="wrapper">
      <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
      <nav class="site-nav">
        <div class="trigger">
          <a class="page-link" href="{{ '/about' | relative_url }}">{% if page.lang == 'zh' %}关于{% else %}About{% endif %}</a>
          <div class="lang-switcher">
            {% assign current_lang = page.lang | default: site.default_lang %}
            {% for lang in site.languages %}
              {% if lang != current_lang %}
                <a href="#" class="lang-link" data-lang="{{ lang }}">{{ site.lang_names[lang] }}</a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="page-content">
    <div class="wrapper">
      {{ content }}
    </div>
  </main>

  <footer class="site-footer">
    <div class="wrapper">
      <div class="footer-col-wrapper">
        <div class="footer-col">
          <p class="footer-text">Connect with us:</p>
          <div class="footer-buttons">
            <a href="{{ site.social.reddit }}" target="_blank" class="footer-button">Reddit</a>
            <a href="mailto:{{ site.social.email }}" class="footer-button">Email</a>
            <a href="{{ site.social.facebook }}" target="_blank" class="footer-button">Facebook</a>
          </div>
        </div>
      </div>
      <div class="footer-col-wrapper">
        <p class="copyright">&copy; 2025 Ray Chen from InkJoy. All rights reserved.</p>
      </div>
    </div>
  </footer>
  
  <!-- Busuanzi 阅读量统计 -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  
  <!-- Language Switcher -->
  <script>
    (function() {
      const langLinks = document.querySelectorAll('.lang-link');
      const currentLang = '{{ page.lang | default: site.default_lang }}';
      const currentRef = '{{ page.ref }}';
      const currentPermalink = '{{ page.permalink }}';
      
      // Build posts map for language switching
      const postsMap = {};
      {% for post in site.posts %}
      {% if post.ref %}
      if (!postsMap['{{ post.ref }}']) {
        postsMap['{{ post.ref }}'] = {};
      }
      postsMap['{{ post.ref }}']['{{ post.lang }}'] = '{{ post.url }}';
      {% endif %}
      {% endfor %}
      
      langLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetLang = this.getAttribute('data-lang');
          let targetUrl = null;
          
          // Try to find by ref first
          if (currentRef && postsMap[currentRef] && postsMap[currentRef][targetLang]) {
            targetUrl = postsMap[currentRef][targetLang];
          } else {
            // Handle homepage switching
            const currentPath = window.location.pathname;
            if (currentPath === '/' || currentPath === '/index.html') {
              targetUrl = targetLang === 'zh' ? '/zh/' : '/';
            } else if (currentPath === '/zh/' || currentPath === '/zh/index.html') {
              targetUrl = '/';
            } else if (currentPath.includes('-zh')) {
              targetUrl = currentPath.replace('-zh', '');
            } else if (currentPath.includes('-en')) {
              targetUrl = currentPath.replace('-en', '');
            } else if (targetLang === 'zh') {
              // Add -zh suffix for Chinese version
              const pathParts = currentPath.split('/');
              const lastPart = pathParts[pathParts.length - 1];
              if (lastPart && lastPart !== '' && lastPart !== 'index.html') {
                pathParts[pathParts.length - 1] = lastPart.replace(/\.html$/, '') + '-zh';
                targetUrl = pathParts.join('/') + '.html';
              } else {
                targetUrl = '/zh/';
              }
            } else {
              targetUrl = currentPath.replace('-zh', '');
            }
          }
          
          if (targetUrl) {
            window.location.href = targetUrl;
          }
        });
      });
    })();
  </script>
</body>
</html>

